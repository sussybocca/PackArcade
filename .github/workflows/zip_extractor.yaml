name: Extract Zip to public/imagine

on:
  push:
    paths:
      - '*.zip'                # only when a zip in root is changed
    branches: [ main ]         # change if your default branch is different
  workflow_dispatch:            # allows manual trigger

jobs:
  extract-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true  # this is the default, but we keep it explicit

      - name: Extract all zip files to public/imagine
        run: |
          mkdir -p public/imagine
          for zipfile in *.zip; do
            [ -e "$zipfile" ] || continue
            echo "Extracting $zipfile ..."
            unzip -o "$zipfile" -d public/imagine/
          done

      - name: Set up git remote with token
        run: |
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

      - name: Commit and push extracted files
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add public/imagine
          if ! git diff --staged --quiet; then
            git commit -m "Extract zip files to public/imagine [skip ci]"
            git push
          else
            echo "No changes to commit"
          fi
