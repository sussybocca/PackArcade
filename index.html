<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Immersive Game Hub – PackArcade</title>
  <link rel="manifest" href="/public/manifest.json">
  <!-- Default favicon (will be changed by user selection) -->
  <link id="dynamic-favicon" rel="icon" type="image/png" href="/public/assets/images/Arcade1.png">
  <style>
    /* Reset everything */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;           /* prevent scroll on the main page */
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(145deg, #0b0f1c 0%, #1a1f33 100%);
      position: relative;
    }

    /* Header – slim, floating, now with toolbar elements */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      padding: 0.5rem 1.5rem;
      background: rgba(10, 15, 30, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
      pointer-events: auto;       /* allow clicks on header elements */
    }

    .header h1 {
      font-size: 1.4rem;
      font-weight: 500;
      background: linear-gradient(135deg, #b8bfff, #a678ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.5px;
    }

    .header p {
      color: #a0a8c0;
      font-size: 0.85rem;
    }

    /* Right side toolbar (favicon selector + install) */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .favicon-selector {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .favicon-selector span {
      color: #a0a8c0;
      font-size: 0.85rem;
    }

    .favicon-option {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.2s;
      background-size: cover;
      background-position: center;
    }

    .favicon-option:hover {
      border-color: #ffaa00;
    }

    .favicon-option.selected {
      border-color: #ff4444;
    }

    .install-btn {
      background: #44aa44;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.85rem;
      transition: background 0.2s;
    }

    .install-btn:hover {
      background: #66cc66;
    }

    #reset-favicon {
      background: transparent;
      color: #a0a8c0;
      border: 1px solid #3a4055;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    #reset-favicon:hover {
      background: rgba(255,255,255,0.1);
      border-color: #ff4444;
    }

    /* iframe container – fills entire viewport */
    .iframe-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #0e121f;        /* fallback color */
    }

    /* Footer – tiny overlay at bottom */
    .footer {
      position: absolute;
      bottom: 0.5rem;
      right: 1rem;
      z-index: 10;
      color: #5b6482;
      font-size: 0.7rem;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      padding: 0.2rem 0.8rem;
      border-radius: 40px;
      pointer-events: none;
    }

    /* On very small screens, keep text readable */
    @media (max-width: 600px) {
      .header h1 { font-size: 1.2rem; }
      .header p { font-size: 0.75rem; }
      .toolbar { gap: 10px; }
      .favicon-option { width: 24px; height: 24px; }
      .install-btn { padding: 4px 8px; font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <!-- Header with integrated PWA toolbar -->
  <header class="header">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <h1>⚡ DIMENSION SELECTOR</h1>
      <p>choose your immersive experience</p>
    </div>
    <div class="toolbar">
      <div class="favicon-selector">
        <span>Favicon:</span>
        <div class="favicon-option selected" data-icon="Arcade1.png" style="background-image: url('assets/images/Arcade1.png');"></div>
        <div class="favicon-option" data-icon="PackArcade1.png" style="background-image: url('assets/images/PackArcade1.png');"></div>
        <div class="favicon-option" data-icon="Arcade2.png" style="background-image: url('assets/images/Arcade2.png');"></div>
        <div class="favicon-option" data-icon="PackArcade2.png" style="background-image: url('assets/images/PackArcade2.png');"></div>
        <div class="favicon-option" data-icon="Arcade3.png" style="background-image: url('assets/images/Arcade3.png');"></div>
        <div class="favicon-option" data-icon="PackArcade3.png" style="background-image: url('assets/images/PackArcade3.png');"></div>
        <div class="favicon-option" data-icon="Arcade4.png" style="background-image: url('assets/images/Arcade4.png');"></div>
        <div class="favicon-option" data-icon="PackArcade4.png" style="background-image: url('assets/images/PackArcade4.png');"></div>
      </div>
      <button class="install-btn" id="install-pwa">Install App</button>
      <button id="reset-favicon">Reset</button>
    </div>
  </header>

  <!-- iframe fills the whole window -->
  <div class="iframe-container">
    <iframe src="public/selector.html" title="Game Selector" loading="lazy"></iframe>
  </div>

  <!-- Tiny footer overlay -->
  <div class="footer">
    <span>✦ auto‑linked from <code>public/imagine/</code> ✦</span>
  </div>

  <!-- Favicon switcher and PWA install script -->
  <script>
    (function() {
      // Favicon switching
      const faviconLink = document.getElementById('dynamic-favicon');
      const options = document.querySelectorAll('.favicon-option');
      let currentIcon = 'Arcade1.png';

      function setFavicon(iconFile) {
        faviconLink.href = 'assets/images/' + iconFile;
        currentIcon = iconFile;
        options.forEach(opt => {
          if (opt.dataset.icon === iconFile) {
            opt.classList.add('selected');
          } else {
            opt.classList.remove('selected');
          }
        });
        localStorage.setItem('packarcade-favicon', iconFile);
      }

      options.forEach(opt => {
        opt.addEventListener('click', () => {
          setFavicon(opt.dataset.icon);
        });
      });

      document.getElementById('reset-favicon').addEventListener('click', () => {
        setFavicon('Arcade1.png');
      });

      const saved = localStorage.getItem('packarcade-favicon');
      if (saved) {
        setFavicon(saved);
      }

      // PWA install prompt
      let deferredPrompt;
      const installBtn = document.getElementById('install-pwa');

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
      });

      installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to install: ${outcome}`);
        deferredPrompt = null;
        installBtn.style.display = 'none';
      });

      window.addEventListener('appinstalled', () => {
        installBtn.style.display = 'none';
        console.log('PWA installed');
      });

      // Register service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/public/service-worker.js')
            .then(reg => console.log('Service Worker registered', reg))
            .catch(err => console.log('Service Worker registration failed', err));
        });
      }
    })();
  </script>
</body>
</html>
